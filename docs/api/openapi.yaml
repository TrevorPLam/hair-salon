openapi: 3.0.3
info:
  title: Hair Salon API
  description: |
    API for the Hair Salon booking and management system.
    
    This API provides endpoints for:
    - Service booking and management
    - Contact form submissions
    - Blog content management
    - Search functionality
    - Analytics and consent management
    
    ## Authentication
    Currently, the API uses public endpoints for client-side operations. 
    Future versions may include authenticated endpoints for admin functionality.
    
    ## Rate Limiting
    All endpoints are subject to rate limiting to prevent abuse.
    Contact form submissions have additional spam protection.
  version: 1.0.0
  contact:
    name: Hair Salon Development Team
    email: dev@hairsalon.example
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://hairsalon.example.com/api
    description: Production server
  - url: http://localhost:3000/api
    description: Development server

paths:
  /contact:
    post:
      tags:
        - Contact
      summary: Submit contact form
      description: |
        Submit a contact form message with spam protection and validation.
        
        The endpoint includes:
        - Input validation using Zod schemas
        - Rate limiting to prevent spam
        - Optional HubSpot integration for lead management
      operationId: submitContactForm
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContactFormSubmission'
            examples:
              validSubmission:
                summary: Valid contact form submission
                value:
                  name: "John Doe"
                  email: "john.doe@example.com"
                  phone: "+1-555-0123"
                  message: "I would like to book a haircut appointment."
                  consent: true
      responses:
        '200':
          description: Contact form submitted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContactFormResponse'
              examples:
                success:
                  summary: Successful submission
                  value:
                    success: true
                    message: "Thank you for your message. We'll get back to you soon!"
        '400':
          description: Bad request - validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                validationError:
                  summary: Validation failed
                  value:
                    error: "Validation failed"
                    details: ["Email is required", "Message must be at least 10 characters"]
        '429':
          description: Too many requests - rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                rateLimitError:
                  summary: Rate limit exceeded
                  value:
                    error: "Too many requests"
                    details: "Please wait before submitting another message."

  /blog/posts:
    get:
      tags:
        - Blog
      summary: Get blog posts
      description: |
        Retrieve blog posts with optional filtering and pagination.
        
        Supports filtering by:
        - Category
        - Publication status
        - Featured status
      operationId: getBlogPosts
      parameters:
        - name: category
          in: query
          description: Filter posts by category
          schema:
            type: string
            enum: [hair-care, styling-tips, trends, treatments, general]
        - name: featured
          in: query
          description: Filter featured posts only
          schema:
            type: boolean
            default: false
        - name: published
          in: query
          description: Filter published posts only
          schema:
            type: boolean
            default: true
        - name: limit
          in: query
          description: Maximum number of posts to return
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: offset
          in: query
          description: Number of posts to skip for pagination
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Blog posts retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BlogPostsResponse'
              examples:
                success:
                  summary: Successful retrieval
                  value:
                    posts:
                      - id: "post-1"
                        title: "Summer Hair Care Tips"
                        slug: "summer-hair-care-tips"
                        excerpt: "Keep your hair healthy and beautiful this summer with these essential tips."
                        category: "hair-care"
                        featured: true
                        published: true
                        publishedAt: "2024-06-15T10:00:00Z"
                        author: "Sarah Johnson"
                        readingTime: 5
                    pagination:
                      total: 25
                      limit: 10
                      offset: 0
                      hasMore: true

  /blog/posts/{slug}:
    get:
      tags:
        - Blog
      summary: Get blog post by slug
      description: Retrieve a specific blog post by its slug
      operationId: getBlogPostBySlug
      parameters:
        - name: slug
          in: path
          required: true
          description: Blog post slug
          schema:
            type: string
            pattern: '^[a-z0-9]+(?:-[a-z0-9]+)*$'
      responses:
        '200':
          description: Blog post retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BlogPostResponse'
        '404':
          description: Blog post not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /search:
    get:
      tags:
        - Search
      summary: Search site content
      description: |
        Search across blog posts, services, and other site content.
        
        Features:
        - Full-text search
        - Relevance scoring
        - Category filtering
        - Result highlighting
      operationId: searchContent
      parameters:
        - name: q
          in: query
          required: true
          description: Search query
          schema:
            type: string
            minLength: 2
            maxLength: 100
        - name: type
          in: query
          description: Filter by content type
          schema:
            type: string
            enum: [blog, services, all]
            default: all
        - name: limit
          in: query
          description: Maximum number of results
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        '200':
          description: Search results retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
        '400':
          description: Bad request - invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /analytics/consent:
    post:
      tags:
        - Analytics
      summary: Update analytics consent
      description: |
        Update user's analytics consent preferences.
        
        This endpoint handles GDPR/CCPA compliance by:
        - Recording consent state
        - Storing consent timestamp
        - Managing consent persistence
      operationId: updateAnalyticsConsent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalyticsConsent'
      responses:
        '200':
          description: Consent updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyticsConsentResponse'
        '400':
          description: Bad request - invalid consent data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    ContactFormSubmission:
      type: object
      required:
        - name
        - email
        - message
        - consent
      properties:
        name:
          type: string
          description: Contact person's full name
          minLength: 2
          maxLength: 100
          example: "John Doe"
        email:
          type: string
          format: email
          description: Contact person's email address
          example: "john.doe@example.com"
        phone:
          type: string
          description: Optional phone number
          pattern: '^[+]?[\d\s\-\(\)]+$'
          example: "+1-555-0123"
        message:
          type: string
          description: Message content
          minLength: 10
          maxLength: 1000
          example: "I would like to book a haircut appointment."
        consent:
          type: boolean
          description: Consent to be contacted
          example: true
        source:
          type: string
          description: Optional source of the contact
          enum: [website, social, referral, other]
          example: "website"

    ContactFormResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Thank you for your message. We'll get back to you soon!"
        id:
          type: string
          description: Unique submission ID
          example: "sub_123456789"

    BlogPost:
      type: object
      required:
        - id
        - title
        - slug
        - excerpt
        - content
        - category
        - published
        - publishedAt
        - author
        - readingTime
      properties:
        id:
          type: string
          description: Unique post identifier
          example: "post-1"
        title:
          type: string
          description: Post title
          example: "Summer Hair Care Tips"
        slug:
          type: string
          description: URL-friendly slug
          pattern: '^[a-z0-9]+(?:-[a-z0-9]+)*$'
          example: "summer-hair-care-tips"
        excerpt:
          type: string
          description: Brief post summary
          maxLength: 200
          example: "Keep your hair healthy and beautiful this summer with these essential tips."
        content:
          type: string
          description: Full post content (MDX format)
          example: "# Summer Hair Care Tips\n\nKeep your hair healthy..."
        category:
          type: string
          enum: [hair-care, styling-tips, trends, treatments, general]
          example: "hair-care"
        featured:
          type: boolean
          description: Whether post is featured
          default: false
        published:
          type: boolean
          description: Whether post is published
          example: true
        publishedAt:
          type: string
          format: date-time
          description: Publication timestamp
          example: "2024-06-15T10:00:00Z"
        author:
          type: string
          description: Post author name
          example: "Sarah Johnson"
        readingTime:
          type: integer
          description: Estimated reading time in minutes
          minimum: 1
          example: 5
        tags:
          type: array
          items:
            type: string
          description: Post tags
          example: ["summer", "hair-care", "tips"]
        coverImage:
          type: string
          format: uri
          description: Optional cover image URL
          example: "https://example.com/images/summer-hair-care.jpg"

    BlogPostsResponse:
      type: object
      required:
        - posts
        - pagination
      properties:
        posts:
          type: array
          items:
            $ref: '#/components/schemas/BlogPost'
        pagination:
          $ref: '#/components/schemas/Pagination'

    BlogPostResponse:
      type: object
      required:
        - post
      properties:
        post:
          $ref: '#/components/schemas/BlogPost'
        relatedPosts:
          type: array
          items:
            $ref: '#/components/schemas/BlogPost'
          description: Related blog posts

    Pagination:
      type: object
      required:
        - total
        - limit
        - offset
        - hasMore
      properties:
        total:
          type: integer
          minimum: 0
          description: Total number of items
          example: 25
        limit:
          type: integer
          minimum: 1
          description: Items per page
          example: 10
        offset:
          type: integer
          minimum: 0
          description: Items skipped
          example: 0
        hasMore:
          type: boolean
          description: Whether more items are available
          example: true

    SearchResult:
      type: object
      required:
        - id
        - title
        - type
        - url
        - score
      properties:
        id:
          type: string
          description: Unique result identifier
          example: "post-1"
        title:
          type: string
          description: Result title
          example: "Summer Hair Care Tips"
        type:
          type: string
          enum: [blog, service, page]
          description: Content type
          example: "blog"
        url:
          type: string
          format: uri
          description: URL to the content
          example: "/blog/summer-hair-care-tips"
        excerpt:
          type: string
          description: Search result excerpt with highlighting
          example: "Keep your hair healthy and beautiful this <mark>summer</mark>..."
        score:
          type: number
          minimum: 0
          maximum: 1
          description: Relevance score
          example: 0.95
        category:
          type: string
          description: Content category (for blog posts)
          example: "hair-care"
        publishedAt:
          type: string
          format: date-time
          description: Publication date (for blog posts)
          example: "2024-06-15T10:00:00Z"

    SearchResponse:
      type: object
      required:
        - results
        - query
        - total
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/SearchResult'
        query:
          type: string
          description: Original search query
          example: "summer hair"
        total:
          type: integer
          minimum: 0
          description: Total number of results
          example: 15
        searchTime:
          type: number
          description: Search execution time in milliseconds
          example: 23

    AnalyticsConsent:
      type: object
      required:
        - consent
      properties:
        consent:
          type: string
          enum: [granted, denied]
          description: User's consent choice
          example: "granted"
        timestamp:
          type: string
          format: date-time
          description: When consent was given
          example: "2024-06-15T10:00:00Z"
        version:
          type: string
          description: Consent policy version
          example: "1.0"

    AnalyticsConsentResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        consent:
          $ref: '#/components/schemas/AnalyticsConsent'
        message:
          type: string
          example: "Consent preferences updated successfully"

    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Error type or message
          example: "Validation failed"
        details:
          oneOf:
            - type: string
            - type: array
              items:
                type: string
          description: Additional error details
          example: ["Email is required", "Message must be at least 10 characters"]
        timestamp:
          type: string
          format: date-time
          description: Error timestamp
          example: "2024-06-15T10:00:00Z"
        requestId:
          type: string
          description: Request identifier for debugging
          example: "req_123456789"

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authenticated endpoints (future use)

tags:
  - name: Contact
    description: Contact form and communication endpoints
  - name: Blog
    description: Blog content management endpoints
  - name: Search
    description: Site search functionality
  - name: Analytics
    description: Analytics and consent management
